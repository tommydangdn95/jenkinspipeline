global
   log /dev/log local0
   log /dev/log local1 notice
   log 127.0.0.1 local2
   log 127.0.0.1 local3
   tune.ssl.default-dh-param 2048
   ssl-dh-param-file /etc/haproxy/dhparam.pem
   chroot /var/lib/haproxy
   stats timeout 30s
   user haproxy
   group haproxy
   daemon

defaults
   log global
   mode http
   option httplog
   option dontlognull
   timeout connect 5000
   timeout client 50000
   timeout server 50000

listen  stats
        bind   0.0.0.0:81
        mode            http
        log             global
        stats enable
        stats hide-version
        stats refresh 30s
        stats show-node
        stats auth admin:admin
        stats uri  /haproxy?stats

userlist authen_job_schedule
  user eoffqn insecure-password Tcx12345

userlist authen_live_fe
  user eoffqn insecure-password Tcx@12345


frontend es
    bind *:9200
    mode http
    default_backend es

# frontend checkuser
#     bind *:8090
#     mode http
#     default_backend checkuser

frontend kibana
    bind *:5601
    mode http
    default_backend kibana

frontend redis
    bind *:6379
    mode tcp
    default_backend redis_cache

# frontend postgres
#     bind *:5432
#     mode tcp
#     default_backend postgres

###################################################
#### Frontend STAGING
###################################################

frontend tomcat-api-hethong-stag
    bind *:8080
    mode http
    default_backend api_hethong

frontend tomcat-api-danhmuc-stag
    bind *:8081
    mode http
    default_backend api_common

frontend tomcat-api-vanbanden-stag
    bind *:8082
    mode http
    default_backend api_vanbanden

frontend tomcat-api-vanbandi-stag
    bind *:8083
    mode http
    default_backend api_vanbandi

frontend tomcat-api-hosocongviec-stag
    bind *:8084
    mode http
    default_backend api_hosocongviec

frontend tomcat-api-lienthong-stag
    bind *:8085
    mode http
    default_backend api_lienthong

frontend tomcat-api-phieuyeucau-stag
    bind *:8087
    mode http
    default_backend api_phieuyeucau

frontend tomcat-api-phieudexuat-stag
    bind *:8088
    mode http
    default_backend api_phieudexuat

frontend tomcat-api-admin-stag
    bind *:8086
    mode http
    default_backend api_admin

frontend tomcat-api-migrated-stag
    bind *:8091
    mode http
    default_backend api_migrated

frontend tomcat-api-authentication-stag
    bind *:8092
    mode http
    default_backend api_authentication
####################
# File Stag via Port
###################

frontend file-staging
    bind *:5000
    mode http
    acl file_upload_staging_ip path -i -m beg /api/file/upload
    use_backend file-api if file_upload_staging_ip

    acl file_get_staging_ip path -i -m beg /api
    use_backend get-file-api if file_get_staging_ip
    default_backend get-file-api    

#############################################################
#  Frontend LIVE
#############################################################

frontend tomcat-api-hethong-live
    bind *:8580
    mode http
    default_backend api_hethong_live

frontend tomcat-api-danhmuc-live
    bind *:8581
    mode http
    default_backend api_common_live

frontend tomcat-api-vanbanden-live
    bind *:8582
    mode http
    log-format "%ci:%cp %si:%sp [%t] %ft %b/%s %Tq/%Tw/%Tc/%Tr/%Tt %ST %B %CC %CS %tsc %ac/%fc/%bc/%sc/%rc %sq/%bq %hr %hs %{+Q}HP"

    default_backend api_vanbanden_live

frontend tomcat-api-vanbandi-live
    bind *:8583
    mode http
    default_backend api_vanbandi_live

frontend tomcat-api-hosocongviec-live
    bind *:8584
    mode http
    default_backend api_hosocongviec_live

frontend tomcat-api-lienthong-live
    bind *:8585
    mode http
    default_backend api_lienthong_live

frontend tomcat-api-phieuyeucau-live
    bind *:8587
    mode http
    default_backend api_phieuyeucau_live

frontend tomcat-api-phieudexuat-live
    bind *:8588
    mode http
    default_backend api_phieudexuat_live

frontend tomcat-api-admin-live
    bind *:8586
    mode http
    default_backend api_admin_live

frontend tomcat-api-migrated-live
    bind *:8591
    mode http
    default_backend api_migrated_live

frontend tomcat-api-authentication-live
    bind *:8592
    mode http
    default_backend api_authentication_live
####################
# File LIVE via Port
###################

frontend file-live
    bind *:5005
    mode http
    acl file_upload_live_ip path -i -m beg /api/file/upload
    use_backend file_api_live if file_upload_live_ip

    acl file_get_live_ip path -i -m beg /api
    use_backend get_file_api_live if file_get_live_ip
    default_backend get_file_api_live
###########################################

frontend nginx_https
    http-response add-header Strict-Transport-Security max-age=31536000;\ includeSubDomains;\ preload
    bind *:443 no-tlsv11 no-tlsv10 no-sslv3 no-tls-tickets  ssl crt /etc/haproxy/ssl/eoffqn.pem ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-GCM-SHA384:AES128-SHA256:AES128-SHA:AES256-SHA256:AES256-SHA:!MD5:!aNULL:!DH:!RC4
    mode http
    http-request deny unless METH_GET or METH_POST or METH_OPTIONS or METH_PUT or METH_DELETE
    
    log-format "%ci:%cp %si:%sp [%t] %ft %b/%s %Tq/%Tw/%Tc/%Tr/%Tt %ST %B %CC %CS %tsc %ac/%fc/%bc/%sc/%rc %sq/%bq %hr %hs %{+Q}HP"

   acl options_method method OPTIONS
   use_backend options_method_backend if options_method

   # capture request header authorization len 4096
   # log-format %[capture.req.hdr(0)]\ %hr\ %hrl\ %hs\ %hsl

    capture request header origin len 4096

    ### FE STAGING ###

    acl stag_host hdr(host) -i qoffice-staging.quangnam.gov.vn
    use_backend nginx if stag_host


    ### Staging HOST ###
    acl api_staging_host hdr(host) -i api-qoffice-staging.quangnam.gov.vn

    ### API Danh muc Static  ###
    acl api_danhmuc_static_path path_beg -i /danh-muc/api/ngon-ngu
    use_backend api_static_backend if api_staging_host api_danhmuc_static_path

    #### API He thong ###
    acl api_hethong_path path_beg -i /he-thong
    use_backend api_hethong if api_staging_host api_hethong_path

    ### API Lien Thong ###
    acl api_lienthong_path path_beg -i /lien-thong
    use_backend api_lienthong if api_staging_host api_lienthong_path

    ### API Danh muc ###
    acl api_danhmuc_path path_beg -i /danh-muc
    use_backend api_common if api_staging_host api_danhmuc_path

    ### API Van Ban Den ###
    acl api_vanbanden_path path_beg -i /van-ban-den
    use_backend api_vanbanden if api_staging_host api_vanbanden_path

    ### API Van Ban Di ###
    acl api_vanbandi_path path_beg -i /van-ban-di
    use_backend api_vanbandi if api_staging_host api_vanbandi_path

    ### API Ho So Cong Viec ###
    acl api_hosocongviec_path path_beg -i /ho-so-cong-viec
    use_backend api_hosocongviec if api_staging_host api_hosocongviec_path

    ### API Phieu Yeu Cau ###
    acl api_phieuyeucau_path path_beg -i /phieu-yeu-cau
    use_backend api_phieuyeucau if api_staging_host api_phieuyeucau_path

    ### API Phieu De Xuat ###
    acl api_phieudexuat_path path_beg -i /phieu-de-xuat
    use_backend api_phieudexuat if api_staging_host api_phieudexuat_path

    ### API Du lieu cu ###
    acl api_migrated_path path_beg -i /migrated
    use_backend api_migrated if api_staging_host api_migrated_path

    acl api_admin_path path_beg -i /admin
    use_backend api_admin if api_staging_host api_admin_path

    acl api_authentication_path path_beg -i /authentication
    use_backend api_authentication if api_staging_host api_authentication_path
    
    ### Staging file HOST ###
    # acl get_method method GET
    # acl upload_method method POST PUT DELETE 
    acl file_staging_host hdr(host) -i file-qoffice-staging.quangnam.gov.vn
    use_backend get-file-api if METH_GET file_staging_host
    use_backend file-api if  file_staging_host
   
    #############################################
    ### DOMAIN LIVE
    ############################################
    
    acl live_host hdr(host) -i qoffice.quangnam.gov.vn
    use_backend nginx-live if  live_host
    
    ### API LIVE
    acl api_live_host hdr(host) -i api-qoffice.quangnam.gov.vn
    
    ### API Danh muc Static  ###
    acl api_danhmuc_live_static_path path_beg -i /danh-muc/api/ngon-ngu
    use_backend api_static_live_backend if api_live_host api_danhmuc_live_static_path

    #### API He thong ###
    acl api_hethong_live_path path_beg -i /he-thong
    use_backend api_hethong_live if api_live_host api_hethong_live_path

    ### API Danh muc ###
    acl api_danhmuc_live_path path_beg -i /danh-muc
    use_backend api_common_live if api_live_host api_danhmuc_live_path

    ### API Van Ban Den ###
    acl api_vanbanden_live_path path_beg -i /van-ban-den
    use_backend api_vanbanden_live if api_live_host api_vanbanden_live_path
    
    ### API Lien Thong ###
    acl api_lienthong_live_path path_beg -i /lien-thong
    use_backend api_lienthong_live if api_live_host  api_lienthong_live_path

    ### API Van Ban Di ###
    acl api_vanbandi_live_path path_beg -i /van-ban-di
    use_backend api_vanbandi_live if api_live_host api_vanbandi_live_path

    ### API Ho So Cong Viec ###
    acl api_hosocongviec_live_path path_beg -i /ho-so-cong-viec
    use_backend api_hosocongviec_live if api_live_host api_hosocongviec_live_path

    ### API Phieu Yeu Cau ###
    acl api_phieuyeucau_live_path path_beg -i /phieu-yeu-cau
    use_backend api_phieuyeucau_live if api_live_host api_phieuyeucau_live_path

    ### API Phieu De Xuat ###
    acl api_phieudexuat_live_path path_beg -i /phieu-de-xuat
    use_backend api_phieudexuat_live if api_live_host api_phieudexuat_live_path

    ### API Du-Lieu-Cu ###
    acl api_migrated_live_path path_beg -i /migrated
    use_backend api_migrated_live if api_live_host api_migrated_live_path

    ### API admin ###
    acl api_admin_live_path path_beg -i /admin
    use_backend api_admin_live if api_live_host api_admin_live_path
   
    ### API authentication ###
    acl api_authentication_live_path path_beg -i /authentication
    use_backend api_authentication_live if api_live_host api_authentication_live_path

    ### Staging file HOST LIVE ###
    # acl get_method method GET
    # acl upload_method method POST PUT DELETE
    acl file_live_host hdr(host) -i file-qoffice.quangnam.gov.vn
    use_backend get_file_api_live if METH_GET file_live_host
    use_backend file_api_live if  file_live_host



    default_backend nginx-live 

#################################################################################################################################

frontend nginx
    bind *:80
    mode http
    log-format "%ci:%cp %si:%sp [%t] %ft %b/%s %Tq/%Tw/%Tc/%Tr/%Tt %ST %B %CC %CS %tsc %ac/%fc/%bc/%sc/%rc %sq/%bq %hr %hs %{+Q}HP"    
   
    http-request deny unless METH_GET or METH_POST or METH_OPTIONS or METH_PUT or METH_DELETE

   acl options_method method OPTIONS
   use_backend options_method_backend if options_method

   # capture request header authorization len 4096
   # log-format %[capture.req.hdr(0)]\ %hr\ %hrl\ %hs\ %hsl

    capture request header origin len 4096

    ### FE STAGING ###

    acl stag_host hdr(host) -i qoffice-staging.quangnam.gov.vn
    use_backend nginx if stag_host


    ### Staging HOST ###
    acl api_staging_host hdr(host) -i api-qoffice-staging.quangnam.gov.vn

    ### API Danh muc Static  ###
    acl api_danhmuc_static_path path_beg -i /danh-muc/api/ngon-ngu
    use_backend api_static_backend if api_staging_host api_danhmuc_static_path

    #### API He thong ###
    acl api_hethong_path path_beg -i /he-thong
    use_backend api_hethong if api_staging_host api_hethong_path

    ### API Lien Thong ###
    acl api_lienthong_path path_beg -i /lien-thong
    use_backend api_lienthong if api_staging_host api_lienthong_path

    ### API Danh muc ###
    acl api_danhmuc_path path_beg -i /danh-muc
    use_backend api_common if api_staging_host api_danhmuc_path

    ### API Van Ban Den ###
    acl api_vanbanden_path path_beg -i /van-ban-den
    use_backend api_vanbanden if api_staging_host api_vanbanden_path

    ### API Van Ban Di ###
    acl api_vanbandi_path path_beg -i /van-ban-di
    use_backend api_vanbandi if api_staging_host api_vanbandi_path

    ### API Ho So Cong Viec ###
    acl api_hosocongviec_path path_beg -i /ho-so-cong-viec
    use_backend api_hosocongviec if api_staging_host api_hosocongviec_path

    ### API Phieu Yeu Cau ###
    acl api_phieuyeucau_path path_beg -i /phieu-yeu-cau
    use_backend api_phieuyeucau if api_staging_host api_phieuyeucau_path

    ### API Phieu De Xuat ###
    acl api_phieudexuat_path path_beg -i /phieu-de-xuat
    use_backend api_phieudexuat if api_staging_host api_phieudexuat_path

    ### API Du lieu cu ###
    acl api_migrated_path path_beg -i /migrated
    use_backend api_migrated if api_staging_host api_migrated_path

    acl api_admin_path path_beg -i /admin
    use_backend api_admin if api_staging_host api_admin_path

    acl api_authentication_path path_beg -i /authentication
    use_backend api_authentication if api_staging_host api_authentication_path
    
    ### Staging file HOST ###
    # acl get_method method GET
    # acl upload_method method POST PUT DELETE 
    acl file_staging_host hdr(host) -i file-qoffice-staging.quangnam.gov.vn
    use_backend get-file-api if METH_GET file_staging_host
    use_backend file-api if  file_staging_host
    
    ### MonitorPath###
    acl monitor_host hdr(host) -i qoffice-monitor.qti.vn

    ### zabbix ###
    acl monitor_zabbix path_beg -i /zabbix
    use_backend zabbix if monitor_host monitor_zabbix
    
    ### Errbit ###
    use_backend errbit if monitor_host
  
    ### CI ###
    acl api_ci_host hdr(host) -i qoffice-ci.qti.vn
    use_backend ci_backend if api_ci_host
    
    ##### ###
    acl log_host hdr(host) -i  notify-qoffice-staging.qti.vn

    ### EM #####
    acl oracle_path path_beg -i /em
    use_backend oracle_em_backend if log_host oracle_path

    #####View Log LIVE##########
    acl log_common_live_path path_beg -i /common-live
    use_backend log_common_live_backend if log_host log_common_live_path

    acl log_user_live_path path_beg -i /user-live
    use_backend log_user_live_backend if log_host log_user_live_path

    acl log_vanbanden_live_path path_beg -i /vanbanden-live
    use_backend log_vanbanden_live_backend if log_host log_vanbanden_live_path

    acl log_vanbandi_live_path path_beg -i /vanbandi-live
    use_backend log_vanbandi_live_backend if log_host log_vanbandi_live_path

    acl log_hscv_live_path path_beg -i /hscv-live
    use_backend log_hscv_live_backend if log_host log_hscv_live_path

    acl log_lienthong_live_path path_beg -i /lienthong-live
    use_backend log_lienthong_live_backend if log_host log_lienthong_live_path

    acl log_phieuyeucau_live_path path_beg -i /phieuyeucau-live
    use_backend log_phieuyeucau_live_backend if log_host log_phieuyeucau_live_path

    acl log_phieudexuat_live_path path_beg -i /phieudexuat-live
    use_backend log_phieudexuat_live_backend if log_host log_phieudexuat_live_path

    acl log_dulieucu_live_path path_beg -i /dulieucu-live
    use_backend log_dulieucu_live_backend if log_host log_dulieucu_live_path

    #####View Log STAGING####
    acl log_common_path path_beg -i /common
    use_backend log_common_backend if log_host log_common_path
 
    acl log_user_path path_beg -i /user
    use_backend log_user_backend if log_host log_user_path

    acl log_vanbanden_path path_beg -i /vanbanden
    use_backend log_vanbanden_backend if log_host log_vanbanden_path

    acl log_vanbandi_path path_beg -i /vanbandi
    use_backend log_vanbandi_backend if log_host log_vanbandi_path

    acl log_hscv_path path_beg -i /hscv
    use_backend log_hscv_backend if log_host log_hscv_path

    acl log_lienthong_path path_beg -i /lienthong
    use_backend log_lienthong_backend if log_host log_lienthong_path

    acl log_phieuyeucau_path path_beg -i /phieuyeucau
    use_backend log_phieuyeucau_backend if log_host log_phieuyeucau_path

    acl log_phieudexuat_path path_beg -i /phieudexuat
    use_backend log_phieudexuat_backend if log_host log_phieudexuat_path

    acl log_dulieucu_path path_beg -i /dulieucu
    use_backend log_dulieucu_backend if log_host log_dulieucu_path


    ###Tyk API GATEWAY###
    acl tyk_api_gateway path_beg -i /#api-gateway
    use_backend tyk-api-gateway if log_host tyk_api_gateway

    ### job-schedule ###
    #acl job_schedule_path path_beg -i /#Login
    #use_backend job-schedule if log_host job_schedule_path
  


    #############################################
    ### DOMAIN LIVE
    ############################################
    
    acl live_host hdr(host) -i qoffice.quangnam.gov.vn
    use_backend nginx-live if  live_host
    
    ### API LIVE
    acl api_live_host hdr(host) -i api-qoffice.quangnam.gov.vn
    
    ### API Danh muc Static  ###
    acl api_danhmuc_live_static_path path_beg -i /danh-muc/api/ngon-ngu
    use_backend api_static_live_backend if api_live_host api_danhmuc_live_static_path

    #### API He thong ###
    acl api_hethong_live_path path_beg -i /he-thong
    use_backend api_hethong_live if api_live_host api_hethong_live_path

    ### API Danh muc ###
    acl api_danhmuc_live_path path_beg -i /danh-muc
    use_backend api_common_live if api_live_host api_danhmuc_live_path

    ### API Van Ban Den ###
    acl api_vanbanden_live_path path_beg -i /van-ban-den
    use_backend api_vanbanden_live if api_live_host api_vanbanden_live_path
    
    ### API Lien Thong ###
    acl api_lienthong_live_path path_beg -i /lien-thong
    use_backend api_lienthong_live if api_live_host  api_lienthong_live_path

    ### API Van Ban Di ###
    acl api_vanbandi_live_path path_beg -i /van-ban-di
    use_backend api_vanbandi_live if api_live_host api_vanbandi_live_path

    ### API Ho So Cong Viec ###
    acl api_hosocongviec_live_path path_beg -i /ho-so-cong-viec
    use_backend api_hosocongviec_live if api_live_host api_hosocongviec_live_path

    ### API Phieu Yeu Cau ###
    acl api_phieuyeucau_live_path path_beg -i /phieu-yeu-cau
    use_backend api_phieuyeucau_live if api_live_host api_phieuyeucau_live_path

    ### API Phieu De Xuat ###
    acl api_phieudexuat_live_path path_beg -i /phieu-de-xuat
    use_backend api_phieudexuat_live if api_live_host api_phieudexuat_live_path

    ### API Du-Lieu-Cu ###
    acl api_migrated_live_path path_beg -i /migrated
    use_backend api_migrated_live if api_live_host api_migrated_live_path

    ### API admin ###
    acl api_admin_live_path path_beg -i /admin
    use_backend api_admin_live if api_live_host api_admin_live_path
   
    ### API authentication ###
    acl api_authentication_live_path path_beg -i /authentication
    use_backend api_authentication_live if api_live_host api_authentication_live_path

    ### LIVE file HOST LIVE ###
    # acl get_method method GET
    # acl upload_method method POST PUT DELETE
    acl file_live_host hdr(host) -i file-qoffice.quangnam.gov.vn
    use_backend get_file_api_live if METH_GET file_live_host
    use_backend file_api_live if  file_live_host
    redirect scheme https code 301 if api_staging_host api_live_host stag_host live_host !{ ssl_fc }
    
    default_backend nginx-live

backend test_web
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
    server nginxhttps1  10.255.35.13:80 check fall 3 rise 2



#----------------------------------------------------------------------
# static backend for serving up images, stylesheets and such
#---------------------------------------------------------------------

backend options_method_backend
    server method1 10.255.35.23:80 check
    server method2 10.255.35.13:80 check

## API ##

backend api_hethong
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
    server api-hethong1  10.255.35.14:8080 check fall 3 rise 2

backend api_common
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
   # server api-common1-gw  10.255.35.11:8081 check fall 3 rise 2
    server api-common  10.255.35.14:8081 check fall 3 rise 2

backend api_vanbanden
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
    server api-vanbanden1  10.255.35.14:8082 check fall 3 rise 2

backend api_vanbandi
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
    server api-vanbandi1  10.255.35.14:8083 check fall 3 rise 2

backend api_hosocongviec
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
    server api-hosocongviec1  10.255.35.14:8084 check fall 3 rise 2

backend api_lienthong
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
    server api-lienthong1  10.255.35.14:8085 check fall 3 rise 2

backend api_phieuyeucau
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
    server api-phieuyeucau1  10.255.35.14:8087 check fall 3 rise 2

backend api_phieudexuat
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
    server api-phieudexuat1  10.255.35.14:8088 check fall 3 rise 2

backend api_admin
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
    server api-admin1  10.255.35.14:8086 check fall 3 rise 2

backend api_authentication
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
    server api-authentication1  10.255.35.14:8086 check fall 3 rise 2

backend api_migrated
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
    server api-dulieucu1  10.255.35.14:8091 check fall 3 rise 2


backend api_static_backend
   http-response set-header Access-Control-Allow-Credentials true
   http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
   server ngon-ngu1 10.255.35.13:81 check
   server ngon-ngu2 10.255.35.23:81 check

backend nginx
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
    server nginx1  10.255.35.13:81 check
    server nginx2  10.255.35.23:81 check

backend zabbix
    #http-response set-header Access-Control-Allow-Credentials true
    #http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
    server zabbix1 10.255.35.21:80 check

backend errbit
    server errbit1 10.255.35.21:8088 check

backend es
    server es1  10.255.35.19:9200 check
    server es2  10.255.35.28:9200 check
    server es3  10.255.35.29:9200 check

backend kibana
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
    #acl auth_ok http_auth(authen_kibana)
    #http-request auth realm MyAuthRealm if !auth_ok
    server kibana1  10.255.35.22:5601 check

backend ci_backend
   server ci1  10.255.35.22:8080 check

backend file-api
     http-response set-header Access-Control-Allow-Credentials true
     http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
     server file-api1  10.255.45.14:5000 check
     server file-api2  10.255.45.14:5001 check
     server file-api3  10.255.45.14:5002 check

     
     
backend get-file-api
     http-response set-header Access-Control-Allow-Credentials true
     http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
     server get-file-api1  10.255.45.14:80 check

backend redis_cache
    mode tcp
    option tcp-check
    tcp-check send AUTH\ redis1234\r\n
    tcp-check send PING\r\n
    tcp-check expect string +PONG
    tcp-check send info\ replication\r\n
    tcp-check expect string role:master
    tcp-check send QUIT\r\n
    tcp-check expect string +OK
#    fullconn 100000
#    option httpchk get /
#    http-check expect ! rstatus ^503$
#    option http-server-close
#    option forceclose
#    option redispatch
    server redis-m1 10.255.35.18:6379 maxconn 1024 check inter 1s 
    server redis-m2 10.255.35.26:6379 maxconn 1024 check inter 1s
    server redis-m3 10.255.35.27:6379 maxconn 1024 check inter 1s


#####backend-log-STAG#######
backend log_common_backend
   server log-common1 10.255.35.14:9901 check

backend log_user_backend
   server log-user1 10.255.35.14:9902 check

backend log_vanbanden_backend
   server log-vanbanden1 10.255.35.14:9903 check

backend log_vanbandi_backend
   server log-vanbandi1 10.255.35.14:9904 check

backend log_hscv_backend
   server log-hscv1 10.255.35.14:9905 check

backend log_lienthong_backend
   server log-lienthong1 10.255.35.14:9906 check

backend log_phieuyeucau_backend
   server log-phieuyeucau1 10.255.35.14:9907 check

backend log_phieudexuat_backend
   server log-phieudexuat1 10.255.35.14:9908 check

backend log_dulieucu_backend
   server log-dulieucu1 10.255.35.14:9909 check

#####backend-log-LIVE########
backend log_common_live_backend
   server log-live-common1 10.255.35.22:9911 check

backend log_user_live_backend
   server log-live-user1 10.255.35.22:9912 check

backend log_vanbanden_live_backend
   server log-live-vanbanden1 10.255.35.22:9913 check

backend log_vanbandi_live_backend
   server log-live-vanbandi1 10.255.35.22:9914 check

backend log_hscv_live_backend
   server log-live-hscv1 10.255.35.22:9915 check

backend log_lienthong_live_backend
   server log-live-lienthong1 10.255.35.22:9916 check

backend log_phieuyeucau_live_backend
   server log-live-phieuyeucau1 10.255.35.22:9917 check

backend log_phieudexuat_live_backend
   server log-live-phieudexuat1 10.255.35.22:9918 check

backend log_dulieucu_live_backend
   server log-live-dulieucu1 10.255.35.22:9919 check

#backend job-schedule
#    http-response set-header Access-Control-Allow-Credentials true
#    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
#    acl auth_ok http_auth(authen_job_schedule)
#    http-request auth realm MyAuthRealm if !auth_ok
#    server job_schedule1  10.255.45.13:3012 check

backend tyk-api-gateway
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
    server tyk-api-gateway1  10.255.35.11:3000 check 


#############################   
### API LIVE
#############################

backend api_static_live_backend
   http-response set-header Access-Control-Allow-Credentials true
   http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
   server ngon-ngu1 10.255.35.23:80 check
   server ngon-ngu2 10.255.35.13:80 check
   
backend nginx-live
    #acl auth_live_ok http_auth(authen_live_fe)
    #http-request auth realm MyAuthRealm if !auth_live_ok
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
    http-response set-header X-Robots-Tag noindex,nofollow
    server nginx-live1  10.255.35.23:80 check
    server nginx-live2  10.255.35.13:80 check

backend api_hethong_live
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
    fullconn 100000
    option httpchk get /
    http-check expect ! rstatus ^503$
    option http-server-close
    option forceclose
    option redispatch
    server api-hethong1  10.255.35.15:8080 check inter 3s fall 1 rise 1
    server api-hethong2  10.255.35.16:8080 check inter 3s fall 1 rise 1 
    server api-hethong3  10.255.35.24:8080 check inter 3s fall 1 rise 1
    server api-hethong4  10.255.35.25:8080 check inter 3s fall 1 rise 1

backend api_common_live
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]    
    server api-common1  10.255.35.15:8081 check inter 3s fall 1 rise 1
    server api-common2  10.255.35.16:8081 check inter 3s fall 1 rise 1
    server api-common3  10.255.35.24:8081 check inter 3s fall 1 rise 1
    server api-common4  10.255.35.25:8081 check inter 3s fall 1 rise 1

    #server api-gateway  10.255.35.11:8081 check fall 3 rise 2


backend api_vanbanden_live
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
    fullconn 100000
    option httpchk get /
    http-check expect ! rstatus ^503$
    option http-server-close
    option forceclose
    option redispatch
    server api-vanbanden1  10.255.35.15:8082 check inter 3s fall 1 rise 1
    server api-vanbanden2  10.255.35.16:8082 check inter 3s fall 1 rise 1
    server api-vanbanden3  10.255.35.24:8082 check inter 3s fall 1 rise 1
    server api-vanbanden4  10.255.35.25:8082 check inter 3s fall 1 rise 1

backend api_vanbandi_live
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
    fullconn 100000
    option httpchk get /
    http-check expect ! rstatus ^503$
    option http-server-close
    option forceclose
    option redispatch
    server api-vanbandi1  10.255.35.15:8083 check inter 3s fall 1 rise 1
    server api-vanbandi2  10.255.35.16:8083 check inter 3s fall 1 rise 1
    server api-vanbandi3  10.255.35.24:8083 check inter 3s fall 1 rise 1
    server api-vanbandi4  10.255.35.25:8083 check inter 3s fall 1 rise 1

backend api_hosocongviec_live
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
    fullconn 100000
    option httpchk get /
    http-check expect ! rstatus ^503$
    option http-server-close
    option forceclose
    option redispatch
    server api-hosocongviec1  10.255.35.15:8084 check inter 3s fall 1 rise 1
    server api-hosocongviec2  10.255.35.16:8084 check inter 3s fall 1 rise 1
    server api-hosocongviec3  10.255.35.24:8084 check inter 3s fall 1 rise 1
    server api-hosocongviec4  10.255.35.25:8084 check inter 3s fall 1 rise 1

backend api_lienthong_live
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
    fullconn 100000
    option httpchk get /
    http-check expect ! rstatus ^503$
    option http-server-close
    option forceclose
    option redispatch
    server api-lienthong1  10.255.35.15:8085 check inter 3s fall 1 rise 1
    server api-lienthong2  10.255.35.16:8085 check inter 3s fall 1 rise 1
    server api-lienthong3  10.255.35.24:8085 check inter 3s fall 1 rise 1
    server api-lienthong4  10.255.35.25:8085 check inter 3s fall 1 rise 1

backend api_admin_live
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
    fullconn 100000
    option httpchk get /
    http-check expect ! rstatus ^503$
    option http-server-close
    option forceclose
    option redispatch
    server api-admin1  10.255.35.15:8086 check inter 3s fall 1 rise 1
    server api-admin2  10.255.35.16:8086 check inter 3s fall 1 rise 1
    server api-admin3  10.255.35.24:8086 check inter 3s fall 1 rise 1
    server api-admin4  10.255.35.25:8086 check inter 3s fall 1 rise 1

backend api_authentication_live
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
    fullconn 100000
    option httpchk get /
    http-check expect ! rstatus ^503$
    option http-server-close
    option forceclose
    option redispatch
    server api-authentication1  10.255.35.15:8086 check inter 3s fall 1 rise 1
    server api-authentication2  10.255.35.16:8086 check inter 3s fall 1 rise 1
    server api-authentication3  10.255.35.24:8086 check inter 3s fall 1 rise 1
    server api-authentication4  10.255.35.25:8086 check inter 3s fall 1 rise 1

backend api_phieuyeucau_live
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]    
    fullconn 100000
    option httpchk get /
    http-check expect ! rstatus ^503$
    option http-server-close
    option forceclose
    option redispatch
    server api-phieuyeucau1  10.255.35.15:8087 check inter 3s fall 1 rise 1
    server api-phieuyeucau2  10.255.35.16:8087 check inter 3s fall 1 rise 1
    server api-phieuyeucau3  10.255.35.24:8087 check inter 3s fall 1 rise 1
    server api-phieuyeucau4  10.255.35.25:8087 check inter 3s fall 1 rise 1

backend api_phieudexuat_live
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
    fullconn 100000
    option httpchk get /
    http-check expect ! rstatus ^503$
    option http-server-close
    option forceclose
    option redispatch
    server api-phieudexuat1  10.255.35.15:8088 check inter 3s fall 1 rise 1
    server api-phieudexuat2  10.255.35.16:8088 check inter 3s fall 1 rise 1
    server api-phieudexuat3  10.255.35.24:8088 check inter 3s fall 1 rise 1
    server api-phieudexuat4  10.255.35.25:8088 check inter 3s fall 1 rise 1


backend api_migrated_live
    http-response set-header Access-Control-Allow-Credentials true
    http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
#    server api-migrated1  10.255.35.15:8091 check fall 3 rise 2
#    server api-migrated2  10.255.35.16:8091 check fall 3 rise 2
    server api-migrated3  10.255.35.24:8091 check fall 3 rise 2
#    server api-migrated4  10.255.35.25:8091 check fall 3 rise 2


backend file_api_live
     http-response set-header Access-Control-Allow-Credentials true
     http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
     server file-api1-live  10.255.45.11:5000 check
     server file-api2-live  10.255.45.11:5001 check
     server file-api3-live  10.255.45.11:5002 check

backend get_file_api_live
     http-response set-header Access-Control-Allow-Credentials true
     http-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]
     server get-file-api1-live  10.255.45.11:80 check

#########  EM  #######
backend oracle_em_backend
     server em-oracle1 10.255.45.12:5520 check



#---------------------------------------------------------------------
# round robin balancing between the various backends
#---------------------------------------------------------------------
